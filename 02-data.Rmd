# データ整備

- AERパッケージに含まれるNMES1988を利用

```{r}
data("close_college",
     package = "causaldata")

raw <- close_college
```

## 新しい変数の作成: mutate (tidyverse)


- tidyverseパッケージに含まれるdplyrパッケージ[@R-dplyr]は、有用な関数を提供

```{r}
library(tidyverse)
```

- mutate関数の利用

```{r}
raw <- mutate(raw,
             square_exper = exper^2,
             college = if_else(educ >= 16, 1, 0)
             )
```


## 変数の限定: select (tidyverse)

- select関数の利用

```{r}
df <- select(raw,
             black,
             smsa
             )
```

- 特定の変数の除外

```{r}
df <- select(raw,
             -black,
             -smsa
             )
```

## サンプルの除外:filter (tidyverse)

- filter関数の利用

```{r}
df <- filter(raw,
             educ >= 7
             )
```



## 記述統計表の作成

- 記述統計の作成には多くの有益なパッケージが存在

- ここではgtsummary[@R-gtsummary]を使用

```{r}
library(gtsummary)
```

- select関数で必要な変数(lwage, black, south, nearc4)を抜き出し、insuranceごとに連続変数については中央値、カテゴリ変数については頻度を記述

```{r}
descriptive <-
  select(raw,
         college,
         lwage,
         black,
         nearc4)

tbl_summary(descriptive,
            by = college)
```

- 連続変数について、平均値と標準偏差を記述


```{r}
descriptive <-
  select(raw,
         college,
         lwage,
         black,
         nearc4)

tbl_summary(descriptive,
            by = college,
            statistic = list(all_continuous() ~ "{mean} ({sd})"))
```
