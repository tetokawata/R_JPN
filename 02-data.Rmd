# データ整備

- AERパッケージに含まれるNMES1988を利用

```{r}
data("NMES1988",
     package = "AER")

raw <- NMES1988
```

## 新しい変数の作成: mutate (tidyverse)


- tidyverseパッケージに含まれるdplyrパッケージ[@R-dplyr]は、有用な関数を提供

```{r}
library(tidyverse)
```

- mutate関数の利用

```{r}
df <- mutate(raw,
             square_age = age^2,
             log_age = log(age),
             total_visit = visits + nvisits + ovisits + novisits
             )
```


## 変数の限定: select (tidyverse)

- select関数の利用

```{r}
df <- select(raw,
             age,
             visits
             )
```

- 特定の変数の除外

```{r}
df <- select(raw,
             -age,
             -visits
             )
```

## サンプルの除外:filter (tidyverse)

- filter関数の利用

```{r}
df <- filter(raw,
             visits >= 5
             )
```



## 記述統計表の作成

- 記述統計の作成には多くの有益なパッケージが存在

- ここではgtsummaryを使用

```{r}
library(gtsummary)
```

- select関数で必要な変数(health, visits, income, insurance)を抜き出し、insuranceごとに連続変数については中央値、カテゴリ変数については頻度を記述

```{r}
descriptive <-
  select(raw,
         insurance,
         health,
         visits,
         income)

tbl_summary(descriptive,
            by = insurance)
```

