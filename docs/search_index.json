[["index.html", "Rによる比較・予測・因果推論入門 ver0.1 はじめに", " Rによる比較・予測・因果推論入門 ver0.1 川田恵介 2021-04-29 はじめに 本ページでは、定量的な比較、（反実仮想）因果推定、予測分析をRによって行う方法を紹介します。 データインポート、整理、可視化を行う関数群を統合的に提供するtidyverseパッケージ(Wickham et al. 2019)の利用を前提にします。 無料で公開されている有力な教科書として、以下を推薦します。 機械学習を用いた予測：James et al. (2013) 公開ページ tidyverseパッケージの利用： 公式ページ "],["intro.html", "Chapter 1 準備", " Chapter 1 準備 オフライン環境の整備 Rのインストール R studioのインストール オンライン環境の整備 R cloudへの登録 "],["データ整備.html", "Chapter 2 データ整備", " Chapter 2 データ整備 AERパッケージに含まれるNMES1988を利用 data(&quot;NMES1988&quot;, package = &quot;AER&quot;) raw &lt;- NMES1988 "],["可視化.html", "Chapter 3 可視化 3.1 ヒストグラム 3.2 密度 3.3 Boxplot", " Chapter 3 可視化 tidyverseに含まれるggplot2パッケージを利用 library(tidyverse) 3.1 ヒストグラム 医療機関の利用回数 ggplot(raw, aes(x = visits) ) + geom_histogram() メディケイド保有別の利用回数 ggplot(raw, aes(x = visits, fill = medicaid) ) + geom_histogram(position = &quot;identity&quot;, alpha = 0.5) 男女・メディケイド保有別の利用回数 ggplot(raw, aes(x = visits, fill = medicaid) ) + geom_histogram(position = &quot;identity&quot;, alpha = 0.5 ) + facet_wrap(~ gender) 3.2 密度 男女・メディケイド保有別の利用回数 ggplot(raw, aes(x = visits, fill = medicaid) ) + geom_density(position = &quot;identity&quot;, alpha = 0.5 ) + facet_wrap(~ gender) 3.3 Boxplot ggplot(raw, aes(y = visits, x = medicaid) ) + geom_boxplot() "],["予測.html", "Chapter 4 予測", " Chapter 4 予測 TBA "],["比較.html", "Chapter 5 比較 5.1 統計的推論", " Chapter 5 比較 5.1 統計的推論 ここでは（条件付き）平均差を、線形モデルを仮定し、信頼区間こみで推定する。 5.1.1 OLS robust standard errorを計算するためにestimatrパッケージを利用 library(estimatr) 条件なし平均差\\(\\tau=E[Y|D=d&#39;]-E[Y|D=d]\\)を推定するために、 \\[E[Y|D=d]=\\beta_0 + \\tau\\times D\\] を仮定し推定 \\(D\\)が2値変数であればノンパラメトリックな推定 それ以外の場合は線形近似モデルを推定 lm_robust(visits ~ medicaid, data = raw) ## Estimate Std. Error t value Pr(&gt;|t|) CI Lower CI Upper DF ## (Intercept) 5.68007 0.1065151 53.326444 0.000000000 5.4712468 5.888893 4404 ## medicaidyes 1.03386 0.3595968 2.875054 0.004058953 0.3288698 1.738851 4404 条件付き平均差\\(\\tau=E[Y|D=d&#39;, X_1,...,X_L]-E[Y|D=d,X_1,...,X_L]\\)を推定するために、 \\[E[Y|D=d,X_1,...,X_L]=\\beta_0 + \\tau\\times D + \\beta_1 X_1+...+\\beta_L X_L\\] を仮定し推定 lm_robust(visits ~ medicaid + age + gender, data = raw) ## Estimate Std. Error t value Pr(&gt;|t|) CI Lower ## (Intercept) 6.09459718 1.1362142 5.3639507 8.559768e-08 3.8670457 ## medicaidyes 0.92367669 0.3616363 2.5541590 1.067785e-02 0.2146876 ## age -0.02596731 0.1513204 -0.1716048 8.637561e-01 -0.3226315 ## gendermale -0.52597827 0.2095122 -2.5104898 1.209196e-02 -0.9367276 ## CI Upper DF ## (Intercept) 8.3221486 4402 ## medicaidyes 1.6326658 4402 ## age 0.2706969 4402 ## gendermale -0.1152289 4402 発展 tidy関数により推定結果data.frameに変化することで、kable関数(knitrパッケージ)による推計結果表の整形、geom_pointrange関数による可視化が可能 推計結果表 点推定値(estimate)、標準誤差(std.error)のみを残した推計結果表 library(knitr) fit &lt;- lm_robust(visits ~ medicaid + gender, data = raw) fit &lt;- tidy(fit) fit &lt;- select(fit, term, estimate, std.error) kable(fit, digits = 2) term estimate std.error (Intercept) 5.90 0.13 medicaidyes 0.92 0.36 gendermale -0.52 0.21 Dot-wisher図による可視化 dot-wisher図による可視化 fit &lt;- lm_robust(visits ~ medicaid + gender, data = raw) fit &lt;- tidy(fit) fit &lt;- filter(fit, term != &quot;(Intercept)&quot;) ggplot(fit, aes(y = term, x = estimate, xmin = conf.low, xmax = conf.high)) + geom_pointrange() "],["因果推論.html", "Chapter 6 因果推論", " Chapter 6 因果推論 TBA "],["references.html", "References", " References James, Gareth, Daniela Witten, Trevor Hastie, and Robert Tibshirani. 2013. An Introduction to Statistical Learning. Vol. 112. Springer. Wickham, Hadley, Mara Averick, Jennifer Bryan, Winston Chang, Lucy D’Agostino McGowan, Romain Francois, Garrett Grolemund, et al. 2019. “Welcome to the tidyverse.” Journal of Open Source Software 4 (43): 1686. https://doi.org/10.21105/joss.01686. "]]
