[["index.html", "Rによる比較・予測・因果推論入門 ver0.1 はじめに", " Rによる比較・予測・因果推論入門 ver0.1 川田恵介 2021-04-30 はじめに 本ページでは、定量的な比較、（反実仮想）因果推定、予測分析をRによって行う方法を紹介します。 データインポート、整理、可視化を行う関数群を統合的に提供するtidyverseパッケージ(Wickham et al. 2019)の利用を前提にします。 AERパッケージ(Kleiber and Zeileis 2008)に含まれるNMES1988を例として使用します。 無料で公開されている有力な参考文献として、以下を推薦します。 機械学習を用いた予測：James et al. (2013) 公開ページ 日本語によるR入門：私たちのR: ベストプラクティスの探究 tidyverseパッケージの利用： 公式ページ "],["intro.html", "Chapter 1 準備", " Chapter 1 準備 オフライン環境の整備 Rのインストール R studioのインストール オンライン環境の整備 R cloudへの登録 "],["識別.html", "Chapter 2 識別 2.1 予測 2.2 比較 2.3 因果効果", " Chapter 2 識別 経済学におけるデータ分析の大部分は、複数の変数間での関係性の理解・利用を目的とします。 ここではある結果変数\\(Y\\)と独立変数（群）\\(X=X_1,...,X_L\\)の関係性に焦点を当てます。 より具体的な目標は大きく（予測）\\(Y\\)の予測、（比較）異なる\\(X\\)間での\\(Y\\)の比較、（因果効果）\\(X\\)の変化が\\(Y\\)に与える因果効果 2.1 予測 2.2 比較 2.3 因果効果 "],["データ整備.html", "Chapter 3 データ整備 3.1 新しい変数の作成: mutate (tidyverse) 3.2 変数の限定: select (tidyverse) 3.3 サンプルの除外:filter (tidyverse)", " Chapter 3 データ整備 AERパッケージに含まれるNMES1988を利用 data(&quot;NMES1988&quot;, package = &quot;AER&quot;) raw &lt;- NMES1988 tidyverseパッケージに含まれるdplyrパッケージ(Wickham et al. 2021)は、有用な関数を提供 library(tidyverse) 3.1 新しい変数の作成: mutate (tidyverse) mutate関数の利用 df &lt;- mutate(raw, square_age = age^2, log_age = log(age), total_visit = visits + nvisits + ovisits + novisits ) 3.2 変数の限定: select (tidyverse) select関数の利用 df &lt;- select(raw, age, visits ) 特定の変数の除外 df &lt;- select(raw, -age, -visits ) 3.3 サンプルの除外:filter (tidyverse) filter関数の利用 df &lt;- filter(raw, visits &gt;= 5 ) "],["可視化.html", "Chapter 4 可視化 4.1 ヒストグラム: geom_histogram (tidyverse) 4.2 密度: geom_density (tidyverse) 4.3 Boxplot: geom_boxplot (tidyverse) 4.4 散布図: geom_point (tidyverse) 4.5 ヒートマップ: geom_bin2d (tidyverse)", " Chapter 4 可視化 tidyverseに含まれるggplot2パッケージ(Wickham et al. 2020)を利用 library(tidyverse) 4.1 ヒストグラム: geom_histogram (tidyverse) 医療機関の利用回数 ggplot(raw, aes(x = visits) ) + geom_histogram() メディケイド保有別の利用回数 ggplot(raw, aes(x = visits, fill = medicaid) ) + geom_histogram(position = &quot;identity&quot;, alpha = 0.5) 男女・メディケイド保有別の利用回数 ggplot(raw, aes(x = visits, fill = medicaid) ) + geom_histogram(position = &quot;identity&quot;, alpha = 0.5 ) + facet_wrap(~ gender) 4.2 密度: geom_density (tidyverse) 男女・メディケイド保有別の利用回数 ggplot(raw, aes(x = visits, fill = medicaid) ) + geom_density(position = &quot;identity&quot;, alpha = 0.5 ) + facet_wrap(~ gender) 4.3 Boxplot: geom_boxplot (tidyverse) ggplot(raw, aes(y = visits, x = medicaid) ) + geom_boxplot() 4.4 散布図: geom_point (tidyverse) 散布図：連続変数間の関係性を可視化する図 ggplot(raw, aes(x = income, y = visits) ) + geom_point() サンプルサイズが大きくなると機能しない 4.5 ヒートマップ: geom_bin2d (tidyverse) 代替案はヒートマップ ggplot(raw, aes(x = income, y = visits) ) + geom_bin2d() "],["予測関数の推定.html", "Chapter 5 予測関数の推定 5.1 データの導入 5.2 データ分割 5.3 OLS 5.4 LASSO/Ridge 5.5 Random Forest/Bagging", " Chapter 5 予測関数の推定 5.1 データの導入 data(&quot;NMES1988&quot;, package = &quot;AER&quot;) raw &lt;- NMES1988 5.2 データ分割 ここでは5個のデータに分割する。 group &lt;- sample(1:5, size = nrow(raw), replace = TRUE) 5.3 OLS 線形予測関数\\(f(X)=\\beta_0 + \\beta_1X_1+...+\\beta_LX_L\\)を仮定し、最小二乗法にて推定する。 fit &lt;- lm(visits ~ ., data = raw[group != 1,]) coef(fit) ## (Intercept) nvisits ovisits novisits emergency ## 3.68133619 0.24035535 0.01665125 0.02242835 0.21370559 ## hospital healthpoor healthexcellent chronic adllimited ## 1.47678275 1.84880957 -1.29254395 0.87467649 0.41121460 ## regionnortheast regionmidwest regionwest age afamyes ## 0.55178270 -0.36941665 0.30332372 -0.33656667 -0.47897234 ## gendermale marriedyes school income employedyes ## -0.44862534 -0.12599146 0.13088446 -0.03569521 0.29689805 ## insuranceyes medicaidyes ## 1.26289316 1.16362618 予測値の導出 Y.hat &lt;- predict(fit,raw) テストデータへの適合 mean((raw$visits - Y.hat)[group == 1]^2) ## [1] 34.4625 訓練データへの適合 mean((raw$visits - Y.hat)[group != 1]^2) ## [1] 38.63441 5.4 LASSO/Ridge Friedman et al. (2021) 5.5 Random Forest/Bagging Wright, Wager, and Probst (2020) "],["パラメータの推定.html", "Chapter 6 パラメータの推定 6.1 OLS:lm_robust (estimatr) 6.2 Double selection 6.3 Double Machine Learning 6.4 Generalized Random Forest", " Chapter 6 パラメータの推定 ここでは（条件付き）平均差を、線形モデルを仮定し、信頼区間こみで推定する。 6.1 OLS:lm_robust (estimatr) robust standard errorを計算するためにestimatrパッケージ(Blair et al. 2021)を利用 library(estimatr) 条件なし平均差\\(\\tau=E[Y|D=d&#39;]-E[Y|D=d]\\)を推定するために、 \\[E[Y|D=d]=\\beta_0 + \\tau\\times D\\] を仮定し推定 \\(D\\)が2値変数であればノンパラメトリックな推定 それ以外の場合は線形近似モデルを推定 lm_robust(visits ~ medicaid, data = raw) ## Estimate Std. Error t value Pr(&gt;|t|) CI Lower CI Upper DF ## (Intercept) 5.68007 0.1065151 53.326444 0.000000000 5.4712468 5.888893 4404 ## medicaidyes 1.03386 0.3595968 2.875054 0.004058953 0.3288698 1.738851 4404 条件付き平均差\\(\\tau=E[Y|D=d&#39;, X_1,...,X_L]-E[Y|D=d,X_1,...,X_L]\\)を推定するために、 \\[E[Y|D=d,X_1,...,X_L]=\\beta_0 + \\tau\\times D + \\beta_1 X_1+...+\\beta_L X_L\\] を仮定し推定 lm_robust(visits ~ medicaid + age + gender, data = raw) ## Estimate Std. Error t value Pr(&gt;|t|) CI Lower ## (Intercept) 6.09459718 1.1362142 5.3639507 8.559768e-08 3.8670457 ## medicaidyes 0.92367669 0.3616363 2.5541590 1.067785e-02 0.2146876 ## age -0.02596731 0.1513204 -0.1716048 8.637561e-01 -0.3226315 ## gendermale -0.52597827 0.2095122 -2.5104898 1.209196e-02 -0.9367276 ## CI Upper DF ## (Intercept) 8.3221486 4402 ## medicaidyes 1.6326658 4402 ## age 0.2706969 4402 ## gendermale -0.1152289 4402 発展 tidy関数により推定結果data.frameに変化することで、kable関数(knitrパッケージ)による推計結果表の整形、geom_pointrange関数による可視化が可能 推計結果表 点推定値(estimate)、標準誤差(std.error)のみを残した推計結果表 library(knitr) fit &lt;- lm_robust(visits ~ medicaid + gender, data = raw) fit &lt;- tidy(fit) fit &lt;- select(fit, term, estimate, std.error) kable(fit, digits = 2) term estimate std.error (Intercept) 5.90 0.13 medicaidyes 0.92 0.36 gendermale -0.52 0.21 Dot-and-Whisker plotによる可視化 Dot-and-Whisker図により点推定量と信頼区間を可視化 fit &lt;- lm_robust(visits ~ medicaid + gender, data = raw) fit &lt;- tidy(fit) fit &lt;- filter(fit, term != &quot;(Intercept)&quot;) ggplot(fit, aes(y = term, x = estimate, xmin = conf.low, xmax = conf.high)) + geom_pointrange() 6.2 Double selection Spindler, Chernozhukov, and Hansen (2019) 6.3 Double Machine Learning Bach et al. (2021) 6.4 Generalized Random Forest Tibshirani, Athey, and Wager (2020) "],["references.html", "References", " References Bach, Philipp, Victor Chernozhukov, Malte S. Kurz, and Martin Spindler. 2021. DoubleML: Double Machine Learning in r. https://CRAN.R-project.org/package=DoubleML. Blair, Graeme, Jasper Cooper, Alexander Coppock, Macartan Humphreys, and Luke Sonnet. 2021. Estimatr: Fast Estimators for Design-Based Inference. https://CRAN.R-project.org/package=estimatr. Friedman, Jerome, Trevor Hastie, Rob Tibshirani, Balasubramanian Narasimhan, Kenneth Tay, and Noah Simon. 2021. Glmnet: Lasso and Elastic-Net Regularized Generalized Linear Models. https://CRAN.R-project.org/package=glmnet. James, Gareth, Daniela Witten, Trevor Hastie, and Robert Tibshirani. 2013. An Introduction to Statistical Learning. Vol. 112. Springer. Kleiber, Christian, and Achim Zeileis. 2008. Applied Econometrics with R. New York: Springer-Verlag. https://CRAN.R-project.org/package=AER. Spindler, Martin, Victor Chernozhukov, and Christian Hansen. 2019. Hdm: High-Dimensional Metrics. https://CRAN.R-project.org/package=hdm. Tibshirani, Julie, Susan Athey, and Stefan Wager. 2020. Grf: Generalized Random Forests. https://github.com/grf-labs/grf. Wickham, Hadley, Mara Averick, Jennifer Bryan, Winston Chang, Lucy D’Agostino McGowan, Romain Francois, Garrett Grolemund, et al. 2019. “Welcome to the tidyverse.” Journal of Open Source Software 4 (43): 1686. https://doi.org/10.21105/joss.01686. Wickham, Hadley, Winston Chang, Lionel Henry, Thomas Lin Pedersen, Kohske Takahashi, Claus Wilke, Kara Woo, Hiroaki Yutani, and Dewey Dunnington. 2020. Ggplot2: Create Elegant Data Visualisations Using the Grammar of Graphics. https://CRAN.R-project.org/package=ggplot2. Wickham, Hadley, Romain Francois, Lionel Henry, and Kirill Muller. 2021. Dplyr: A Grammar of Data Manipulation. https://CRAN.R-project.org/package=dplyr. Wright, Marvin N., Stefan Wager, and Philipp Probst. 2020. Ranger: A Fast Implementation of Random Forests. https://github.com/imbs-hl/ranger. "]]
